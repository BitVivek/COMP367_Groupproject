<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View and Update Patient Information</title>
    <link rel="stylesheet" href="formstyles.css">
</head>
<body>
    <div class="container">
        <h1>View and Update Patient Information</h1>
        <nav>
            <ul class="navbar">
                <li class="home-icon">
                    <a href="index.html">
                        <img src="homepage.ico" alt="Home Icon" class="icon-img">
                    </a>
                </li>
                <li class="dropdown">
                    <a href="doctor_portal.html" class="dropbtn">Doctor Portal</a>
                    <div class="dropdown-content">
                        <a href="schedule_appointment.html">Schedule Appointment</a>
                        <a href="view_update_patient_info.html">View/Update Patient Info</a>
                    </div>
                </li>
                <li class="dropdown">
                    <a href="patient_portal.html" class="dropbtn">Patient Portal</a>
                    <div class="dropdown-content">
                        <a href="access_health_records.html">Access Health Records</a>
                        <a href="book_appointment.html">Book Appointment</a>
                    </div>
                </li>
                <li>
                    <a href="nurse_portal.html">Nurse Portal</a>
                </li>
                <li>
                    <a href="register_patient.html">Register Patient</a>
                </li>
            </ul>
        </nav>
        <div class="form-container"></div>
        <h2>Patient Information</h2>
        <form id="patientInfoForm">
            <!-- <label for="patientName">Patient Name:</label>
            <input type="text" id="patientName" name="patientName" value="John Doe"><br> -->

            <label for="patientName">Patient Name:</label>
            <select id="patientName" name="patientName" required onchange="handlePatientSelection(this.value)"></select><br>
            
            <label for="age">Date of Birth</label>
            <input type="text" id="dateOfBirth" name="dateOfBirth" disabled><br>
            
            <label for="gender">Gender:</label>
            <input type="text" id="gender" name="gender" disabled><br>
            
            <label for="history">Medical History:</label>
            <textarea id="history" name="history" rows="5">Patient's medical history...</textarea><br>
            
            <label for="diagnosis">Diagnosis:</label>
            <textarea id="diagnosis" name="diagnosis" rows="5">Current diagnosis or notes...</textarea><br>
            
            <h2>Vital Signs</h2>
            <label for="bloodPressure">Blood Pressure:</label>
            <input type="number" id="bloodPressure" name="bloodPressure"><br>
            
            <label for="heartRate">Heart Rate:</label>
            <input type="number" id="heartRate" name="heartRate"><br>
            
            <label for="temperature">Temperature:</label>
            <input type="number" id="temperature" name="temperature"><br>
            
            <button type="submit">Update Information</button>
        </form>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/api/patients')
                .then(response => response.json())
                .then(patients => {
                    const patientSelect = document.getElementById('patientName');
                    patients.forEach(patient => {
                        const option = document.createElement('option');
                        option.value = patient._id;
                        option.textContent = patient.name;
                        patientSelect.appendChild(option);
                    });
                });
        });

        function handlePatientSelection(patientId) {
            fetch(`/api/patients/${patientId}`)
                .then(response => response.json())
                .then(patient => {
                    console.log(patient);
                    document.getElementById('heartRate').value = parseInt(patient.heartRate);
                    document.getElementById('bloodPressure').value = parseInt(patient.bloodPressure);
                    document.getElementById('temperature').value = parseInt(patient.temperature); 
                    document.getElementById('dateOfBirth').value = patient.dateOfBirth ? new Date(patient.dateOfBirth).toISOString().split('T')[0] : ''; // Format to YYYY-MM-DD
                    document.getElementById('gender').value = patient.Gender; 
                    document.getElementById('history').value = patient.medicalHistory; 
                    document.getElementById('diagnosis').value = patient.diagnosis;


                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }

        document.getElementById('patientInfoForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const updatedData = {
                // dateOfBirth: document.getElementById('dob').value,
                medicalHistory: document.getElementById('history').value,
                diagnosis: document.getElementById('diagnosis').value,
                bloodPressure: document.getElementById('bloodPressure').value,
                heartRate: document.getElementById('heartRate').value,
                temperature: document.getElementById('temperature').value

            };

            let patientId = document.getElementById('patientName').value
            console.log(patientId);
            console.log(updatedData);
            fetch(`/api/patients/${patientId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(updatedData)
            })
            .then(response => response.json())
            .then(data => {
                alert('Patient information updated successfully!');
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    </script>
</body>
</html>
